<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		
		<title>X-Tag - Custom Tag Registry</title>
		
		<link href="images/shortcut.png" rel="shortcut icon" type="image/x-icon" />
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/global.css"/>
		<link href='http://fonts.googleapis.com/css?family=Days+One|Righteous' rel='stylesheet' type='text/css'>
	</head>

<body>

<header>
	<span id="logo">&lt;<span>x</span>&gt;</span>
	<h1>Tag Registry</h1>
</header>

<div id="tags" class="max-width">
	
	
	<section id="controls">
		<ul id="search_controls">
			<li id="search_query"><input id="search_input" type="text" /><button id="search_button">Search</button><button id="advanced_button"></button></li>
		</ul>
		
		<div id="advanced_controls">
			<div>
				<dl id="groups">
					<dt>Group By:</dt>
					<dd>
						<input type="radio" value="default" name="browse" checked="checked" />
						<button>Default</button>
					
						<input type="radio" value="category" name="browse" />
						<button>Category</button>
					
						<input type="radio" value="author" name="browse" />
						<button>Author</button>
					</dd>
				</dl>
				
				<dl id="filters">
					<dt>Compatibility</dt>
					<dd id="compatiblity">
						<div id="firefox_compatibility" class="slider"></div>
						<div id="chrome_compatibility" class="slider"></div>
						<div id="ie_compatibility" class="slider"></div>
						<div id="opera_compatibility" class="slider"></div>
						<div id="android_compatibility" class="slider"></div>
						<div id="ios_compatibility" class="slider"></div>
					</dd>
				</dl>
			</div>
		</div>
	</section>

	<dl id="results">
	
	</dl>

</div>

</body>

<script type="text/javascript" src="js/mootools-core-1.4.5.js"></script>
<script type="text/javascript" src="js/Extend.Core.js"></script>
<script type="text/javascript" src="js/Extend.DOM.js"></script>
<script type="text/javascript" src="js/mootools-more-1.4.0.1.js"></script>
<script type="text/javascript" src="js/Extend.More.js"></script>
<script type="text/javascript" src="js/Template.js"></script>
<script type="text/javascript" src="js/ContentBox.js"></script>

<script type="text/javascript">

(function(){
	
	TagResult = new Class({
		
		Extends: Template,
		
		Template: {
			name: 'TagResult',
			html: '<dd class="{resultClass}">' +
				'<a class="tag-demo" target="_blank" href="http://jsfiddle.net/8aDzz/4/"></a>' +
				'<div class="tag-header">' +
					'<h3>' +
						'<a class="tag-name" target="_blank" href="{url}">{name}</a>' +
						'<span class="tag-author">by <a target="_blank" href="http://github.com/{author}">{author}</a></span>' +
						'<span class="tag-version">latest <a href="#{author}-{repo_name}-{version}">{version}&#9662;</a></span>' +
					'</h3>' +
					'<nav class="tag-categories"></nav>' +
				'</div>' +
				'<p class="tag-description">{description}</p>' +
				'<ul class="tag-compatibility"></ul>' +
				'<ul class="tag-version-list"></ul>' +
			'</dd>'
		},
		
		createElement: function(data) {
			this.parent(data);
			
			var categoryList = this.element.getElement('nav.tag-categories');
			data.category.each(function(category){
				new Element('a', {
					html: '<b>' + category + '</b>'
				}).inject(categoryList);
			});
			
			var compatibilityList = this.element.getElement('ul.tag-compatibility');
			Object.each(data.compatibility, function(value, key){
				new Element('li', {
					'class': 'browser ' + key,
					text: value
				}).inject(compatibilityList);
			});
			
			return this;
		}
		
	});
	
	
	TagSearch = new Class({
	
		Extends: ContentBox,
		
		Binds: ['search'],
		
		Plugins: {
			searchRequest: Request.JSON
		},
		
		options: {
			searchRequest: {
				url: '/search',
				onSuccess: function(response){
					this.data = response.data;
					this.base['groupBy' + $('groups').getElement('input:checked').value.capitalize()]();
				},
			}
		},
		
		search: function(){
			var self = this,
				search = { query: $('search_input').value };
			if (Object.equals(search, this.lastSearch)) return this;
			
			this.lastSearch = search;
			this.collapse(function(){
				self.element.empty();
				self.searchRequest.get(search);
			});
			return this;
		},
		
		blink: function(fn){
			this.collapse(function(){
				fn.call(this);
				this.show();
			});
			return this;
		},
		
		groupByDefault: function(){
			this.blink(function(){
				this.element.empty();
				this.searchRequest.data.each(function(result){
					new TagResult().createElement(result).element.inject(this.element);
				}, this);
			});
		},
		
		groupByCategory: function(){
			this.blink(function(){
				var self = this,
					categories = {};
					
				this.element.empty();
				this.searchRequest.data.each(function(result){
					result.category.each(function(category){
						result.resultClass = 'result-category-' + category;
						new TagResult().createElement(result).element.inject(categories[category] = categories[category] || new Element('dt').inject(self.element), 'after');
					});
					Object.each(categories, function(element, category){
						element.set('html', category.capitalize() + ' <span>(' + $$('.result-category-' + category).length + ')</span>');
					});
				});
			});
		},
		
		groupByAuthor: function(){
			this.blink(function(){
				var self = this,
					authors = {};
				this.element.empty();
				this.searchRequest.data.each(function(result){
					result.resultClass = 'result-author-' + result.author;
					new TagResult().createElement(result).element.inject(authors[result.author] = authors[result.author] || new Element('dt').inject(self.element), 'after');
				});
				Object.each(authors, function(element, author){
					element.set('html', '<a href="https://github.com/' + author + '">' + author + '</a> <span>(' + $$('.result-author-' + author).length + ')</span>');
				});
			});
		}
		
	});
	
	
	var advancedBox = new ContentBox($('advanced_controls').getFirst(), { wrap: $('advanced_controls') });
	RegistrySearch = new TagSearch('results').search();
	
	window.addEvents({
		'keydown:relay(#search_input):keys(enter)': RegistrySearch.search,
		'click:relay(#search_button)': RegistrySearch.search,
		'click:relay(#groups button)': function(){
			var radio = this.getPrevious();
			if (!radio.checked || RegistryKeyboard.shiftDown){
				radio.checked = true;
				RegistrySearch['groupBy' + radio.value.capitalize()]();
			}
		},
		'click:relay(#advanced_button)': function(){
			var shown = $('advanced_controls').getStyle('height') == 'auto';
			this[shown ? 'removeClass' : 'addClass']('pressed');
			advancedBox[shown ? 'collapse' : 'show']();
		}
	});
	
	RegistryKeyboard = new Keyboard({
		defaultEventType: 'keyup',
		events: {
			'keydown:shift': function(){
				this.shiftDown = true;
			},
			'shift': function(){
				this.shiftDown = false;
			}
		}
	}).activate();

})();

</script>

</html>
